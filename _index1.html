<head>
<meta charset="UTF-8"><!--必ずheadの真下におく-->


<meta name="viewport" content="width=device-width,initial-scale=1.0">

<style>
body{
  margin: 0;
}
*{
  box-sizing: border-box;
  word-break: break-all;
}
.crypt-button{
  background-color: #333;
  color: #fff;
  cursor: pointer;
  margin: 0 auto;
  width :100px;
  padding: 15px;
}
.crypt-message-container{
  border: 1px solid #333;
  padding: 10px;
  border-radius: 3px;
  margin-bottom: 20px;
  width: 100%;
}
</style>
<link rel="stylesheet" href="reset.scss">

</head>
<body>
  
<div id="js--crypt-button" class="crypt-button">ボタン</div>


<p class="crypt-message-container js--crypt-message-container">
    準備中です。
</p>
<p class="crypt-message-container ">
  準備中です。
  準備中です。
  準備中です。
  準備中です。
  準備中です。
  準備中です。
  準備中です。
  準備中です。
  準備中です。
  準備中です。
  準備中です。
  準備中です。
  準備中です。
  準備中です。
  準備中です。
  準備中です。
  準備中です。
  準備中です。
  準備中です。
  準備中です。
  準備中です。
</p>

<script>

var debug = '';

let ele = document.getElementById('js--crypt-button');
ele.addEventListener("click", function(){
  let randomCharsData = "abcdefghijklmnopqrstuvwxyz0123456789";

  console.log('click')
  main();
  // crypt text
  function main(){
    let eleCollection = document.getElementsByClassName('js--crypt-message-container');
    // type conversioning HTMLcollection to Array
    let eleArray = Array.from( eleCollection );
    eleArray.forEach(function(ele,i,array){
      //change text to random text
      crypt(ele);
    })
  }

/*
  function randomizeChar(ele,i){
    let randomChar = "";
    randomizeChar += randomCharsData[Math.floor(Math.random()*randomCharsData.length)];
    debug = ele
    ele[i].innertText = randomChar;
  }
*/
  function crypt(ele){
    let eleText = ele.textContent;
    console.log(eleText.length)
    let randomText = "";
    let randomIndex = [];
    let eleIndex = [];
    let randomChar = '';
    

    for(let i=0; i<eleText.length; i++){
      let newText = '';
      //ランダムな文字列を取得
      randomChar = randomCharsData[Math.floor(Math.random()*randomCharsData.length)];
      //randomIndexに剃って一文字ずつランダムな文字列に変更
      newText += eleText.slice(0,randomIndex[i]).toString();
      newText += randomChar.toString();
      newText += eleText.slice(randomIndex[i]+1).toString();
      
      //eleText = newText;
      //ele.innerText = newText;
      //console.log(newText);
    }


    function getBaseIndex(text){
      return new Promise(function(resolve){
        baseIndex = [];
        for(let i=0; i<text.length; i++){
          // [1, 2, ... , eleの文字数]
          baseIndex.push(i+1);
          if(i == text.length -1){
            resolve(baseIndex);
          }
        }        
      });
    }
    
    async function getRandomIndex(baseIndex,text){
        randomIndex = [];
        console.log(text)
        let data = [];
        data[0] = baseIndex;
        data[1] = randomIndex;
        
        for(let i=0; i<text.length; i++){
          // 「1〜eleの文字数」の値をrandomに振り分けた配列を作成
          /*
          randomIndex.push(baseIndex[Math.floor(Math.random()*baseIndex.length)]);
          baseIndex.splice(i,1);
          */
          
          data = await makeRandomIndex(data)
          if(i == text.length -1){
            resolve(randomIndex);
          }
        }        
      
    }

    function makeRandomIndex(array){
      return new Promise(function(resolve){
        b = array['baseIndex']
        r = array['randomIndex']
        r.push(b[Math.floor(Math.random()*b.length)]);
        b.splice(i,1);
        newArray['baseIndex'] = b;
        newArray['baseIndex'] = r;
        resolve(newArray);
      });
    }



    async function randomizeText(text) {
      try {
        let baseIndex = await getBaseIndex(text); // a.txtを読み込んでwriteDataへ代入
        let randomIndex = await getRandomIndex(baseIndex,text); // d.txtへ書き込み
      } catch (err) {
        console.error(err);s
      }
    }

    randomizeText(eleText);

    //randomText += randomCharsData[Math.floor(Math.random()*randomCharsData.length)];
    
    //ele.innerText = randomText;
  }
}, false);



function testa() {
  return new Promise(function(resolve, reject){        
    console.log('teesa')
    setTimeout(function(){
      console.log('testa success')
      resolve('test');
    }, 3000)
  });

}

function testb() {
  return new Promise(function(resolve, reject){
    console.log('teesb')
    setTimeout(function(){
      console.log('testb success')
      resolve('test');
    }, 3000)
  });
}

async function readAndWrite() {
  try {
    let a = await testa(); // a.txtを読み込んでwriteDataへ代入
    await testb(); // d.txtへ書き込み
  } catch (err) {
    console.error(err);
  }
}

readAndWrite();



</script>

<script>
    var debug = '';
    let ele = document.getElementById('js--test-crypt-button');
    ele.addEventListener("click", function(){
      let randomCharsData = "abcdefghijklmnopqrstuvwxyz0123456789";
    
      console.log('click')
      main();
      
      // crypt text
      function main(){
        let eleCollection = document.getElementsByClassName('js--crypt-message-container');
        // type conversioning HTMLcollection to Array
        let eleArray = Array.from( eleCollection );
        eleArray.forEach(function(v,i,array){
          //change text to random text
          
          
          /*
          for(let i=0; i<v.length; i++){
            randomizeChar(v,i);
            //setInterval(randomizeChar(v,i),1000);
          }
          */
        })
      }
    
    /*
      function randomizeChar(ele,i){
        let randomChar = "";
        randomizeChar += randomCharsData[Math.floor(Math.random()*randomCharsData.length)];
        debug = ele
        ele[i].innertText = randomChar;
      }
    */
      function crypt(ele){
        let randomText = "";
        
        for(var i=0; i<ele.length; i++){
          randomText += randomCharsData[Math.floor(Math.random()*randomCharsData.length)];
    
        }
        ele.innerText = randomText;
      }
    }, false);
    
    
    
    
    </script>
<!--
参考
Javascriptでランダムな文字列を生成する方法 - Qiita
https://qiita.com/ryounagaoka/items/4736c225bdd86a74d59c
-->


</body>

